{% extends 'base/base.html' %}
{% load static %}

{% block title %}Dashboard - FX Bot Monitor{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="container-mobile">
        <!-- Header -->
        <div class="mb-4 fade-in">
            <h1 class="mb-2">Dashboard</h1>
            <p class="text-secondary">บัญชีเทรดของคุณ</p>
        </div>

        <!-- Refresh Indicator (hidden by default) -->
        <div id="refresh-indicator" style="opacity: 0; text-align: center; padding: 10px; transition: opacity 0.3s;">
            <i class="bi bi-arrow-down-circle spinner-primary"></i>
        </div>

        <!-- Trading Accounts List -->
        <div id="accounts-container">
            {% if accounts %}
                {% for account in accounts %}
                <div class="account-card glass-card fade-in" data-account-id="{{ account.id }}" {% if account.subscription_status != 'PENDING' %}onclick="window.location.href='{% url 'account_detail' account.id %}'" style="cursor: pointer;"{% else %}style="cursor: not-allowed; opacity: 0.7;"{% endif %}>
                    <div class="account-card-header">
                        <div>
                            <h3 class="account-name">{{ account.account_name }}</h3>
                            <p class="broker-name">{{ account.broker_name }}</p>
                            {% if account.active_bot %}
                            <p class="text-muted" style="font-size: 12px; margin-top: 4px; margin-bottom: 0;">
                                <i class="bi bi-robot me-1"></i>{{ account.active_bot.name }}{% if account.active_bot.version %} v{{ account.active_bot.version }}{% endif %}{% if account.trade_config.enabled_symbols %} • {{ account.trade_config.enabled_symbols|join:", " }}{% endif %}
                            </p>
                            {% endif %}
                        </div>
                        {% if account.subscription_status == 'PENDING' %}
                        <span class="badge-glass badge-warning">
                            รอตรวจสอบ
                        </span>
                        {% else %}
                        <span class="badge-glass {% if account.bot_status == 'ACTIVE' %}badge-active{% elif account.bot_status == 'PAUSED' %}badge-paused{% else %}badge-down{% endif %}">
                            {{ account.get_bot_status_display }}
                        </span>
                        {% endif %}
                    </div>

                    <div class="account-balance">
                        ฿{{ account.current_balance|floatformat:2 }}
                    </div>

                    <div class="account-stats">
                        <div class="stat-item">
                            <span class="stat-label">Open Positions</span>
                            <span class="stat-value">{{ account.open_positions_count }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Current P&L</span>
                            <span class="stat-value {% if account.current_pnl >= 0 %}text-profit{% else %}text-loss{% endif %}">
                                {% if account.current_pnl >= 0 %}+{% endif %}฿{{ account.current_pnl|floatformat:2 }}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Subscription</span>
                            <span class="stat-value {% if account.days_until_expiry <= 7 %}text-loss{% else %}text-secondary{% endif %}">
                                {{ account.days_until_expiry }} วัน
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Empty State -->
                <div class="empty-state glass-card-static">
                    <i class="bi bi-wallet2"></i>
                    <div class="empty-state-title">ยังไม่มีบัญชีเทรด</div>
                    <div class="empty-state-text">เริ่มต้นด้วยการเพิ่มบัญชีเทรดของคุณ</div>
                    <a href="{% url 'subscription_packages' %}" class="btn btn-primary-blue mt-3">
                        + เพิ่มบัญชีเทรด
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Add Account Button -->
        {% if accounts %}
        <div class="mt-4 text-center fade-in">
            <a href="{% url 'subscription_packages' %}" class="btn btn-glass">
                + เพิ่มบัญชีเทรด
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block bottom_nav %}
{% include 'base/bottom_nav.html' %}
{% endblock %}
