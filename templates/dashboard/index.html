{% extends 'base/base.html' %}
{% load static %}

{% block title %}Dashboard - FX Bot Monitor{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="container-mobile">
        <!-- Header -->
        <div class="mb-4 fade-in">
            <h1 class="mb-2">Dashboard</h1>
            <p class="text-secondary">บัญชีเทรดของคุณ</p>
        </div>

        <!-- Refresh Indicator (hidden by default) -->
        <div id="refresh-indicator" style="opacity: 0; text-align: center; padding: 10px; transition: opacity 0.3s;">
            <i class="bi bi-arrow-down-circle spinner-primary"></i>
        </div>

        <!-- Trading Accounts List -->
        <div id="accounts-container">
            {% if accounts %}
                {% for account in accounts %}
                <div class="account-card glass-card fade-in" onclick="window.location.href='{% url 'account_detail' account.id %}'">
                    <div class="account-card-header">
                        <div>
                            <h3 class="account-name">{{ account.account_name }}</h3>
                            <p class="broker-name">{{ account.broker_name }}</p>
                        </div>
                        <span class="badge-glass {% if account.bot_status == 'ACTIVE' %}badge-active{% elif account.bot_status == 'PAUSED' %}badge-paused{% else %}badge-down{% endif %}">
                            {{ account.get_bot_status_display }}
                        </span>
                    </div>

                    <div class="account-balance">
                        ฿{{ account.current_balance|floatformat:2 }}
                    </div>

                    <div class="account-stats">
                        <div class="stat-item">
                            <span class="stat-label">Open Positions</span>
                            <span class="stat-value">{{ account.open_positions_count }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Current P&L</span>
                            <span class="stat-value {% if account.current_pnl >= 0 %}text-profit{% else %}text-loss{% endif %}">
                                {% if account.current_pnl >= 0 %}+{% endif %}฿{{ account.current_pnl|floatformat:2 }}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Subscription</span>
                            <span class="stat-value {% if account.days_until_expiry <= 7 %}text-loss{% else %}text-secondary{% endif %}">
                                {{ account.days_until_expiry }} วัน
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Empty State -->
                <div class="empty-state glass-card-static">
                    <i class="bi bi-wallet2"></i>
                    <div class="empty-state-title">ยังไม่มีบัญชีเทรด</div>
                    <div class="empty-state-text">เริ่มต้นด้วยการเพิ่มบัญชีเทรดของคุณ</div>
                    <a href="{% url 'subscription_packages' %}" class="btn btn-primary-blue mt-3">
                        <i class="bi bi-plus-circle me-2"></i>เพิ่มบัญชีเทรด
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Add Account Button -->
        {% if accounts %}
        <div class="mt-4 text-center fade-in">
            <a href="{% url 'subscription_packages' %}" class="btn btn-glass">
                <i class="bi bi-plus-circle me-2"></i>เพิ่มบัญชีเทรด
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block bottom_nav %}
{% include 'base/bottom_nav.html' %}
{% endblock %}

{% block extra_js %}
<script>
    // Auto refresh every 30 seconds
    setInterval(function() {
        // Reload account data without full page refresh
        // This will be implemented with AJAX later
        console.log('Auto refresh triggered');
    }, 30000);
</script>
{% endblock %}
