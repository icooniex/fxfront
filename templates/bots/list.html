{% extends 'base/base.html' %}
{% load static %}

{% block title %}Bot Strategies - FX Bot Monitor{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="container-mobile">
        <!-- Header -->
        <div class="mb-4 fade-in">
            <h1 class="mb-2">ü§ñ Bot Strategies</h1>
            <p class="text-secondary">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Bot Trading ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        {% if bots %}
        <!-- Bot Cards Grid -->
        <div class="row g-3">
            {% for bot in bots %}
            <div class="col-12">
                <div class="glass-card fade-in" onclick="window.location.href='{% url 'bot_detail' bot.id %}'" style="cursor: pointer; padding: 20px;">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h3 class="mb-2" style="font-size: 1.25rem;">{{ bot.name }}</h3>
                            <div class="d-flex gap-2 flex-wrap">
                                <span class="badge-glass {% if bot.status == 'ACTIVE' %}badge-active{% elif bot.status == 'BETA' %}badge-warning{% else %}badge-paused{% endif %}">
                                    {{ bot.get_status_display }}
                                </span>
                                <span class="badge-glass" style="background: rgba(21, 139, 249, 0.1); color: #158bf9;">v{{ bot.version }}</span>
                                {% if bot.strategy_type %}
                                <span class="badge-glass" style="background: rgba(255, 255, 255, 0.05);">{{ bot.strategy_type }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <p class="text-secondary mb-3" style="font-size: 0.9rem;">
                        {{ bot.description|truncatewords:20 }}
                    </p>

                    <!-- Allowed Symbols -->
                    {% if bot.allowed_symbols %}
                    <div class="mb-3">
                        <div class="stat-label mb-2">‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:</div>
                        <div class="d-flex flex-wrap gap-2">
                            {% for symbol in bot.allowed_symbols %}
                            <span class="badge-glass" style="background: rgba(255, 255, 255, 0.03); font-size: 0.85rem;">{{ symbol }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Latest Backtest Result -->
                    {% if bot.latest_backtest %}
                    <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 16px; margin-top: 16px;">
                        <div class="stat-label mb-3">‡∏ú‡∏• Backtest ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                        <div class="account-stats">
                            <div class="stat-item">
                                <span class="stat-label">Win Rate</span>
                                <span class="stat-value {% if bot.latest_backtest.win_rate >= 50 %}text-profit{% else %}text-loss{% endif %}">
                                    {{ bot.latest_backtest.win_rate }}%
                                </span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Trades</span>
                                <span class="stat-value">{{ bot.latest_backtest.total_trades }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Profit</span>
                                <span class="stat-value {% if bot.latest_backtest.total_profit >= 0 %}text-profit{% else %}text-loss{% endif %}">
                                    {{ bot.latest_backtest.total_profit|floatformat:2 }}
                                </span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Max DD</span>
                                <span class="stat-value text-loss">
                                    {{ bot.latest_backtest.max_drawdown_percent|floatformat:2 }}%
                                </span>
                            </div>
                        </div>
                        <div class="text-secondary mt-2" style="font-size: 0.85rem;">
                            <i class="bi bi-clock"></i> {{ bot.latest_backtest.run_date|date:"d M Y" }}
                        </div>
                    </div>
                    {% else %}
                    <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 16px; margin-top: 16px;">
                        <div class="text-secondary" style="font-size: 0.9rem;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏• Backtest</div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- No Bots Available -->
        <div class="empty-state glass-card-static">
            <i class="bi bi-robot"></i>
            <div class="empty-state-title">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Bot ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
            <div class="empty-state-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block bottom_nav %}
{% include 'base/bottom_nav.html' %}
{% endblock %}
